<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestionale Studio â€“ Programma Lavori</title>

<style>
:root{
  --nero:#111;
  --bordo:#ddd;
  --grigio:#eee;
  --verde:#b7e3b7;
  --rosso:#f3b1b1;
  --giallo:#f6e7a1;
  --blu:#b7d4f3;
}
body{
  font-family: system-ui, sans-serif;
  margin:0;
}
header{
  padding:20px 32px;
  border-bottom:2px solid var(--nero);
  display:flex;
  justify-content:space-between;
}
main{padding:32px;}
.box{border:1px solid var(--bordo); padding:24px;}
h3{margin-top:0}

.lavori-wrap{display:flex; gap:32px;}
.lista{width:35%}
#lista-lavori{list-style:none; padding:0; margin:0}

.lavoro{
  border:1px solid var(--bordo);
  padding:10px;
  margin-bottom:8px;
  cursor:pointer;
  background:#fff;
}
.lavoro-header{
  display:flex;
  align-items:center;
  gap:8px;
}
.drag{cursor:grab}
.codice{font-weight:700}
.badge{
  display:inline-block;
  padding:2px 6px;
  font-size:12px;
  margin-left:4px;
}
.fase{background:var(--grigio)}
.attivo{background:var(--verde)}
.urgente{background:var(--rosso)}
.attesa{background:var(--giallo)}
.archiviato{background:var(--blu)}

button{padding:6px 10px; cursor:pointer}

#scheda{width:65%; border-left:1px solid var(--bordo); padding-left:24px}

.fasi span{
  display:inline-block;
  padding:4px 6px;
  border:1px solid var(--bordo);
  margin:2px;
  cursor:pointer;
}
.fasi span.attiva{background:var(--grigio)}

@media print{
  header, #scheda, button{display:none}
  .lista{width:100%}
  body{-webkit-print-color-adjust:exact; print-color-adjust:exact}
}
</style>
</head>

<body>

<header>
  <strong>PROGRAMMA LAVORI</strong>
  <button onclick="window.print()">ðŸ–¨ Stampa</button>
</header>

<main>
<div class="box">
  <button onclick="nuovoLavoro()">+ Nuovo lavoro</button>

  <div class="lavori-wrap">
    <div class="lista">
      <ul id="lista-lavori"></ul>
    </div>

    <div id="scheda">
      <em>Seleziona un lavoro</em>
    </div>
  </div>
</div>
</main>

<script>
const FASI = [
 "Progettazione Generale","Modellazione","Relazione Illustrativa",
 "Ricerca - Studio","Sopralluogo Cantiere",
 "Riunione - Incontro","Direzione Lavori - Coordinamento","Altro"
];

let lavori = JSON.parse(localStorage.getItem("lavori")) || [];

function salva(){ localStorage.setItem("lavori",JSON.stringify(lavori)); render(); }

function nuovoLavoro(){
 lavori.push({codice:"",titolo:"",fasi:[],stato:"Attivo"});
 salva();
}

function render(){
 const ul=document.getElementById("lista-lavori");
 ul.innerHTML="";
 lavori.forEach((l,i)=>{
  const li=document.createElement("li");
  li.className="lavoro";
  li.draggable=true;
  li.ondragstart=e=>e.dataTransfer.setData("i",i);
  li.ondragover=e=>e.preventDefault();
  li.ondrop=e=>{
    const a=e.dataTransfer.getData("i");
    lavori.splice(i,0,lavori.splice(a,1)[0]);
    salva();
  };
  li.onclick=()=>apri(i);

  li.innerHTML=`
   <div class="lavoro-header">
    <span class="drag">â˜°</span>
    <span class="codice">${l.codice}</span>
    <span>${l.titolo}</span>
   </div>
   <div>
    ${l.fasi.map(f=>`<span class="badge fase">${f}</span>`).join("")}
    <span class="badge ${l.stato.toLowerCase().replace(" ","")}">${l.stato}</span>
   </div>`;
  ul.appendChild(li);
 });
}

function apri(i){
 const l=lavori[i];
 document.getElementById("scheda").innerHTML=`
  Codice<br><input value="${l.codice}" oninput="lavori[${i}].codice=this.value;salva()"><br><br>
  Titolo<br><input value="${l.titolo}" oninput="lavori[${i}].titolo=this.value;salva()"><br><br>

  <strong>FASI</strong><br>
  <div class="fasi">
   ${FASI.map(f=>`
    <span class="${l.fasi.includes(f)?"attiva":""}"
     onclick="
      const a=lavori[${i}].fasi;
      a.includes('${f}')?a.splice(a.indexOf('${f}'),1):a.push('${f}');
      salva();
     ">${f}</span>`).join("")}
  </div><br>

  Stato<br>
  <select onchange="lavori[${i}].stato=this.value;salva()">
   ${["Attivo","Urgente","In attesa","Archiviato"].map(s=>
    `<option ${s===l.stato?"selected":""}>${s}</option>`).join("")}
  </select>
 `;
}

render();
</script>

</body>
</html>
