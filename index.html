<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestionale Studio â€“ Programma Lavori</title>

<style>
:root{
  --nero:#111;
  --bordo:#ddd;
  --grigio:#f2f2f2;

  --attivo:#c8f7c5;
  --urgente:#f7c5c5;
  --attesa:#f7f3c5;
  --archiviato:#c5d9f7;
}

body{
  font-family: system-ui, sans-serif;
  margin:0;
  color:var(--nero);
}

header{
  padding:20px 32px;
  border-bottom:2px solid var(--nero);
  display:flex;
  justify-content:space-between;
}

button{
  padding:6px 10px;
  border:1px solid var(--nero);
  background:white;
  cursor:pointer;
}

main{
  padding:32px;
}

.layout{
  display:flex;
  gap:32px;
}

/* LISTA */
#lista{
  width:40%;
  list-style:none;
  padding:0;
  margin:0;
}

.lavoro{
  border:1px solid var(--bordo);
  padding:12px;
  margin-bottom:8px;
  cursor:pointer;
  background:white;
}

.lavoro:hover{ background:#f5f5f5 }

.codice{ font-weight:700; margin-right:6px }

.badge{
  display:inline-block;
  padding:2px 6px;
  font-size:12px;
  margin-left:6px;
  background:var(--grigio);
}

.stato.Attivo{ background:var(--attivo) }
.stato.Urgente{ background:var(--urgente) }
.stato.In_attesa{ background:var(--attesa) }
.stato.Archiviato{ background:var(--archiviato) }

/* SCHEDA */
#scheda{
  width:60%;
  border-left:1px solid var(--bordo);
  padding-left:24px;
}

.campo{ margin-bottom:16px }
label{ font-size:12px; color:#666 }
input,select,textarea{
  width:100%;
  padding:8px;
  border:1px solid var(--bordo);
}

/* STAMPA */
@media print{
  header, #scheda, button{ display:none }
  #lista{ width:100% }
}
</style>
</head>

<body>

<header>
  <div>
    <h1>GESTIONALE STUDIO</h1>
    <small>Programma Lavori</small>
  </div>
  <div>
    <button onclick="aggiungi()">ï¼‹ Nuovo</button>
    <button onclick="window.print()">ðŸ–¨ Stampa</button>
  </div>
</header>

<main>
<div class="layout">

<ul id="lista"></ul>

<div id="scheda">
  <em>Seleziona un lavoro</em>
</div>

</div>
</main>

<script>
const FASI = [
  "Progettazione Generale",
  "Modellazione",
  "Relazione Illustrativa",
  "Ricerca - Studio",
  "Sopralluogo Cantiere",
  "Riunione - Incontro",
  "Direzione Lavori - Coordinamento",
  "Altro"
];

const STATI = ["Attivo","Urgente","In attesa","Archiviato"];

let lavori = JSON.parse(localStorage.getItem("lavori")) || [
  {codice:"PR-01", titolo:"Nuovo Museo", fase:FASI[0], stato:"Attivo", note:""}
];

let attivo = null;

function salva(){
  localStorage.setItem("lavori", JSON.stringify(lavori));
  render();
}

function render(){
  const ul = document.getElementById("lista");
  ul.innerHTML = "";
  lavori.forEach((l,i)=>{
    const li = document.createElement("li");
    li.className="lavoro";
    li.innerHTML = `
      <span class="codice">${l.codice}</span>
      ${l.titolo}
      <span class="badge">${l.fase}</span>
      <span class="badge stato ${l.stato.replace(" ","_")}">${l.stato}</span>
    `;
    li.onclick = ()=>apri(i);
    ul.appendChild(li);
  });
}

function apri(i){
  attivo = i;
  const l = lavori[i];
  document.getElementById("scheda").innerHTML = `
    <div class="campo">
      <label>Codice</label>
      <input value="${l.codice}" oninput="lavori[${i}].codice=this.value;salva()">
    </div>
    <div class="campo">
      <label>Titolo</label>
      <input value="${l.titolo}" oninput="lavori[${i}].titolo=this.value;salva()">
    </div>
    <div class="campo">
      <label>Fase</label>
      <select onchange="lavori[${i}].fase=this.value;salva()">
        ${FASI.map(f=>`<option ${f==l.fase?"selected":""}>${f}</option>`).join("")}
      </select>
    </div>
    <div class="campo">
      <label>Stato</label>
      <select onchange="lavori[${i}].stato=this.value;salva()">
        ${STATI.map(s=>`<option ${s==l.stato?"selected":""}>${s}</option>`).join("")}
      </select>
    </div>
    <div class="campo">
      <label>Note</label>
      <textarea rows="2" oninput="lavori[${i}].note=this.value;salva()">${l.note}</textarea>
    </div>
    <button onclick="elimina(${i})">ðŸ—‘ Elimina</button>
  `;
}

function aggiungi(){
  lavori.push({
    codice:"NUOVO",
    titolo:"Nuovo lavoro",
    fase:FASI[0],
    stato:"Attivo",
    note:""
  });
  salva();
}

function elimina(i){
  if(confirm("Eliminare il lavoro?")){
    lavori.splice(i,1);
    document.getElementById("scheda").innerHTML="<em>Seleziona un lavoro</em>";
    salva();
  }
}

document.addEventListener("keydown",e=>{
  if(e.key==="Escape"){
    document.getElementById("scheda").innerHTML="<em>Seleziona un lavoro</em>";
  }
});

render();
</script>

</body>
</html>
