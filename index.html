<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestionale Studio â€“ Arch. Aurelio Pezzola</title>

<style>
:root {
  --nero:#111;
  --bordo:#ddd;
}

/* BASE */
body {
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  margin:0;
  background:white;
  color:var(--nero);
}

header {
  border-bottom:2px solid var(--nero);
  padding:24px 32px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

main { padding:32px; }

button {
  padding:8px 12px;
  border:1px solid var(--nero);
  background:white;
  cursor:pointer;
}

/* PROGRAMMA */
#programma {
  display:flex;
  gap:32px;
}

#lista {
  width:35%;
  list-style:none;
  padding:0;
  margin:0;
}

#lista li {
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px;
  border:1px solid var(--bordo);
  margin-bottom:8px;
  background:white;
}

.handle { cursor:grab; }

/* TAG */
.tag {
  font-size:11px;
  padding:2px 6px;
  border-radius:4px;
  color:white;
}

/* FASI */
.fase.Progettazione { background:#2c3e50; }
.fase.Modellazione { background:#8e44ad; }
.fase.Relazione { background:#2980b9; }
.fase.Ricerca { background:#16a085; }
.fase.Sopralluogo { background:#d35400; }
.fase.Riunione { background:#c0392b; }
.fase.Coordinamento { background:#7f8c8d; }
.fase.Altro { background:#34495e; }

/* STATI */
.stato.Attivo { background:#27ae60; }
.stato.Urgente { background:#e74c3c; }
.stato.In_attesa { background:#3498db; }
.stato.Archiviato { background:#7f8c8d; }

/* SCHEDA */
#scheda {
  width:65%;
  border-left:1px solid var(--bordo);
  padding-left:24px;
}

.campo { margin-bottom:14px; }
label { font-size:12px; color:#666; }

input, textarea, select {
  width:100%;
  padding:8px;
  border:1px solid #ccc;
}

/* STAMPA */
@media print {
  #scheda, button { display:none; }
  #lista { width:100%; }
}
</style>
</head>

<body>

<header>
  <h1>GESTIONALE STUDIO</h1>
  <button onclick="window.print()">ðŸ–¨ Stampa</button>
</header>

<main>
<button onclick="aggiungi()">ï¼‹ Aggiungi lavoro</button>

<div id="programma">
<ul id="lista"></ul>
<div id="scheda"><em>Seleziona un lavoro</em></div>
</div>
</main>

<script>
const FASI = [
  ["Progettazione","Progettazione generale"],
  ["Modellazione","Modellazione tridimensionale"],
  ["Relazione","Relazione scritta"],
  ["Ricerca","Studio e ricerca"],
  ["Sopralluogo","Sopralluogo cantiere"],
  ["Riunione","Riunione / incontro"],
  ["Coordinamento","Coordinamento / DL"],
  ["Altro","Altro"]
];

let lavori = JSON.parse(localStorage.getItem("lavori")) || [
  {codice:"FRAM-01", nome:"Nuovo Museo FRAM", fase:"Progettazione", stato:"Attivo", note:""}
];

function salva() {
  localStorage.setItem("lavori", JSON.stringify(lavori));
}

function render() {
  const ul = document.getElementById("lista");
  ul.innerHTML = "";
  lavori.forEach((l,i)=>{
    ul.innerHTML += `
      <li draggable="true" ondragstart="drag(${i})" ondrop="drop(${i})" ondragover="event.preventDefault()">
        <span class="handle">â˜°</span>
        <strong>${l.codice}</strong> â€“ ${l.nome}
        <span class="tag fase ${l.fase}">${l.fase}</span>
        <span class="tag stato ${l.stato.replace(" ","_")}">${l.stato}</span>
        <span style="margin-left:auto;cursor:pointer" onclick="apri(${i})">âœŽ</span>
      </li>`;
  });
}

function apri(i) {
  const l = lavori[i];
  document.getElementById("scheda").innerHTML = `
    <div class="campo">
      <label>Codice</label>
      <input value="${l.codice}" style="font-weight:bold"
        oninput="lavori[${i}].codice=this.value;salva();render()">
    </div>

    <div class="campo">
      <label>Nome</label>
      <input value="${l.nome}"
        oninput="lavori[${i}].nome=this.value;salva();render()">
    </div>

    <div class="campo">
      <label>Fase</label>
      <select onchange="lavori[${i}].fase=this.value;salva();render()">
        ${FASI.map(f=>`<option value="${f[0]}" ${l.fase===f[0]?"selected":""}>${f[1]}</option>`).join("")}
      </select>
    </div>

    <div class="campo">
      <label>Stato</label>
      <select onchange="lavori[${i}].stato=this.value;salva();render()">
        ${["Attivo","Urgente","In attesa","Archiviato"].map(s=>`<option ${l.stato===s?"selected":""}>${s}</option>`).join("")}
      </select>
    </div>

    <div class="campo">
      <label>Note</label>
      <textarea rows="2"
        oninput="lavori[${i}].note=this.value;salva()">${l.note}</textarea>
    </div>

    <button onclick="elimina(${i})">ðŸ—‘ Elimina lavoro</button>
  `;
}

function aggiungi() {
  lavori.push({codice:"", nome:"Nuovo lavoro", fase:"Progettazione", stato:"Attivo", note:""});
  salva(); render();
}

function elimina(i) {
  if(confirm("Eliminare questo lavoro?")) {
    lavori.splice(i,1);
    salva(); render();
    document.getElementById("scheda").innerHTML="<em>Seleziona un lavoro</em>";
  }
}

let dragIndex;
function drag(i){ dragIndex=i; }
function drop(i){
  const tmp=lavori[dragIndex];
  lavori.splice(dragIndex,1);
  lavori.splice(i,0,tmp);
  salva(); render();
}

document.addEventListener("keydown",e=>{
  if(e.key==="Escape") document.getElementById("scheda").innerHTML="<em>Seleziona un lavoro</em>";
});

render();
</script>

</body>
</html>
