<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Programma Lavori â€“ Gestionale Studio</title>

<style>
:root{
  --nero:#111;
  --grigio:#666;
  --bordo:#ddd;
  --bg:#f5f5f5;

  --attivo:#2ecc71;
  --urgente:#e74c3c;
  --attesa:#f1c40f;
  --archiviato:#3498db;
}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  margin:0;
  color:var(--nero);
}

header{
  padding:20px 32px;
  border-bottom:2px solid var(--nero);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header h1{margin:0;font-size:26px;}
header h2{margin:4px 0 0;font-size:13px;color:var(--grigio);font-weight:normal;}

button{
  padding:8px 12px;
  border:1px solid var(--nero);
  background:white;
  cursor:pointer;
  font-weight:500;
}

main{padding:32px;}

.box{
  border:1px solid var(--bordo);
  padding:24px;
}

#layout{
  display:flex;
  gap:32px;
}

/* LISTA */
#lista{
  width:40%;
  list-style:none;
  padding:0;
  margin:0;
}

.item{
  border:1px solid var(--bordo);
  padding:12px;
  margin-bottom:8px;
  cursor:pointer;
  background:white;
}

.item:hover{background:var(--bg);}

.codice{font-weight:bold;margin-right:6px;}

.tag{
  display:inline-block;
  padding:2px 6px;
  font-size:12px;
  border-radius:3px;
  margin-left:6px;
  background:#eee;
}

.stato.attivo{background:var(--attivo);color:#000;}
.stato.urgente{background:var(--urgente);color:#fff;}
.stato.attesa{background:var(--attesa);color:#000;}
.stato.archiviato{background:var(--archiviato);color:#fff;}

/* SCHEDA */
#scheda{
  width:60%;
  border-left:1px solid var(--bordo);
  padding-left:24px;
}

.campo{margin-bottom:16px;}
label{display:block;font-size:12px;color:var(--grigio);margin-bottom:4px;}
input,textarea{
  width:100%;
  padding:8px;
  font-family:inherit;
}

.fasi label{
  display:block;
  font-size:13px;
}

/* STAMPA */
@media print{
  header,#scheda{display:none;}
  #lista{width:100%;}
  body{font-size:12px;}
  .item{page-break-inside:avoid;}
}
</style>
</head>

<body>

<header>
  <div>
    <h1>PROGRAMMA LAVORI</h1>
    <h2>Arch. Aurelio Pezzola</h2>
  </div>
  <button onclick="window.print()">ðŸ–¨ Stampa</button>
</header>

<main>
  <div class="box">
    <button onclick="nuovo()">ï¼‹ Nuovo lavoro</button>

    <div id="layout" style="margin-top:16px;">
      <ul id="lista"></ul>
      <div id="scheda"><em>Seleziona un lavoro</em></div>
    </div>
  </div>
</main>

<script>
/* DATI */
const FASI=[
 "Progettazione Generale",
 "Modellazione",
 "Relazione Illustrativa",
 "Ricerca - Studio",
 "Sopralluogo Cantiere",
 "Riunione - Incontro",
 "Direzione Lavori - Coordinamento",
 "Altro"
];

const STATI={
 "Attivo":"attivo",
 "Urgente":"urgente",
 "In attesa":"attesa",
 "Archiviato":"archiviato"
};

let progetti = JSON.parse(localStorage.getItem("progetti")) || [
  {
    codice:"FRAM-01",
    titolo:"Nuovo Museo FRAM",
    fasi:["Progettazione Generale"],
    stato:"Attivo",
    note:""
  }
];

let attivo=null;

/* SALVATAGGIO */
function salva(){
  localStorage.setItem("progetti",JSON.stringify(progetti));
  render();
}

/* RENDER LISTA */
function render(){
  const ul=document.getElementById("lista");
  ul.innerHTML="";
  progetti.forEach((p,i)=>{
    const li=document.createElement("li");
    li.className="item";
    li.onclick=()=>apri(i);

    li.innerHTML=`
      <span class="codice">${p.codice}</span>
      <span>${p.titolo}</span>
      ${p.fasi.map(f=>`<span class="tag">${f}</span>`).join("")}
      <span class="tag stato ${STATI[p.stato]}">${p.stato}</span>
    `;
    ul.appendChild(li);
  });
}

/* SCHEDA */
function apri(i){
  attivo=i;
  const p=progetti[i];

  document.getElementById("scheda").innerHTML=`
    <div class="campo">
      <label>Codice</label>
      <input value="${p.codice}" oninput="pCodice(this.value)">
    </div>

    <div class="campo">
      <label>Titolo</label>
      <input value="${p.titolo}" oninput="pTitolo(this.value)">
    </div>

    <div class="campo fasi">
      <label>Fasi</label>
      ${FASI.map(f=>`
        <label>
          <input type="checkbox" ${p.fasi.includes(f)?"checked":""}
            onchange="toggleFase('${f}',this.checked)">
          ${f}
        </label>
      `).join("")}
    </div>

    <div class="campo">
      <label>Stato</label>
      <select onchange="pStato(this.value)">
        ${Object.keys(STATI).map(s=>`
          <option ${s===p.stato?"selected":""}>${s}</option>
        `).join("")}
      </select>
    </div>

    <div class="campo">
      <label>Note</label>
      <textarea rows="2" oninput="pNote(this.value)">${p.note}</textarea>
    </div>

    <button onclick="elimina()">Elimina lavoro</button>
  `;
}

/* MODIFICHE */
function pCodice(v){progetti[attivo].codice=v;salva();}
function pTitolo(v){progetti[attivo].titolo=v;salva();}
function pStato(v){progetti[attivo].stato=v;salva();}
function pNote(v){progetti[attivo].note=v;salva();}

function toggleFase(f,ok){
  const arr=progetti[attivo].fasi;
  if(ok && !arr.includes(f)) arr.push(f);
  if(!ok) progetti[attivo].fasi=arr.filter(x=>x!==f);
  salva();
}

/* NUOVO / ELIMINA */
function nuovo(){
  progetti.push({
    codice:"",
    titolo:"Nuovo progetto",
    fasi:[],
    stato:"Attivo",
    note:""
  });
  salva();
}

function elimina(){
  if(attivo===null)return;
  progetti.splice(attivo,1);
  attivo=null;
  document.getElementById("scheda").innerHTML="<em>Seleziona un lavoro</em>";
  salva();
}

/* ESC */
document.addEventListener("keydown",e=>{
  if(e.key==="Escape"){
    attivo=null;
    document.getElementById("scheda").innerHTML="<em>Seleziona un lavoro</em>";
  }
});

render();
</script>
</body>
</html>
