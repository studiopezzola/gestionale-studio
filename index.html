<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestionale Studio â€“ Arch. Aurelio Pezzola</title>

<style>
:root {
  --nero:#111;
  --grigio:#666;
  --bordo:#ddd;
}

body {
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  margin:0;
  color:var(--nero);
}

header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:24px 32px;
  border-bottom:2px solid var(--nero);
}

nav { display:none; } /* per ora nascondiamo tutto il resto */

main { padding:32px; }

.box {
  border:1px solid var(--bordo);
  padding:24px;
}

#lista-lavori {
  list-style:none;
  padding:0;
  margin:0;
  width:35%;
}

#lista-lavori li {
  padding:12px;
  border:1px solid #ddd;
  margin-bottom:8px;
  cursor:grab;
  background:white;
  font-weight:500;
  display:flex;
  align-items:center;
  gap:8px;
}

#lista-lavori li:hover { background:#f5f5f5; }

.maniglia {
  cursor:grab;
}

/* COLORI STATO */
.stato-Attivo { border-left:6px solid #2ecc71; }
.stato-Urgente { border-left:6px solid #e74c3c; }
.stato-In-pausa { border-left:6px solid #f39c12; }
.stato-In-attesa { border-left:6px solid #7f8c8d; }
.stato-Archiviato { border-left:6px solid #bdc3c7; opacity:.6; }

#scheda {
  width:65%;
  border-left:1px solid #ddd;
  padding-left:24px;
}

.campo { margin-bottom:16px; }
.campo label {
  font-size:12px;
  color:#666;
  display:block;
  margin-bottom:4px;
}
.campo input,.campo select,.campo textarea {
  width:100%;
  padding:8px;
  border:1px solid #ccc;
}

.placeholder {
  color:#666;
  font-style:italic;
}

/* STAMPA */
@media print {
  .azioni-globali { display:none; }
  body { font-size:12px; }
}
</style>
</head>

<body>

<header>
  <div>
    <h1>GESTIONALE STUDIO</h1>
    <h2 style="font-weight:normal;color:#666">Architetto Aurelio Pezzola</h2>
  </div>
  <div class="azioni-globali">
    <button onclick="window.print()">ðŸ–¨ Stampa</button>
  </div>
</header>

<main>
<div class="box">
<h3>Programma Lavori</h3>

<div style="display:flex;gap:32px;">
  <ul id="lista-lavori"></ul>

  <div id="scheda">
    <p class="placeholder">Seleziona un lavoro per vedere la scheda progetto.</p>
  </div>
</div>
</div>
</main>

<script>
let progetti = JSON.parse(localStorage.getItem("progetti")) || [
  { codice:"FRAM-01", nome:"Nuovo Museo FRAM", stato:"Attivo", fase:"Progetto definitivo", note:"" },
  { codice:"BRE-02", nome:"Via Cambrant", stato:"In attesa", fase:"Studio preliminare", note:"" },
  { codice:"ERB-03", nome:"Cantina Camilucci", stato:"In-pausa", fase:"Cantiere", note:"" }
];

function salva() {
  localStorage.setItem("progetti", JSON.stringify(progetti));
}

function renderLista() {
  const lista = document.getElementById("lista-lavori");
  lista.innerHTML = "";

  progetti.forEach((p,i)=>{
    const li = document.createElement("li");
    li.className = "stato-" + p.stato;
    li.draggable = true;
    li.innerHTML = `<span class="maniglia">â˜°</span> ${p.nome}`;
    li.onclick = () => apriScheda(i);

    li.addEventListener("dragstart",e=>e.dataTransfer.setData("i",i));
    li.addEventListener("dragover",e=>e.preventDefault());
    li.addEventListener("drop",e=>{
      const from = e.dataTransfer.getData("i");
      const to = i;
      progetti.splice(to,0,progetti.splice(from,1)[0]);
      salva(); renderLista();
    });

    lista.appendChild(li);
  });
}

function apriScheda(i){
  const p = progetti[i];
  document.getElementById("scheda").innerHTML = `
    <div style="display:flex;gap:16px;">
      <div class="campo" style="width:30%">
        <label>Codice</label>
        <input value="${p.codice}" disabled>
      </div>
      <div class="campo" style="width:70%">
        <label>Nome</label>
        <input value="${p.nome}" disabled>
      </div>
    </div>

    <div class="campo">
      <label>Fase</label>
      <select onchange="p.fase=this.value;salva()">
        ${["Studio preliminare","Progetto definitivo","Progetto esecutivo","Cantiere","Concluso"]
          .map(f=>`<option ${p.fase===f?"selected":""}>${f}</option>`).join("")}
      </select>
    </div>

    <div class="campo">
      <label>Stato</label>
      <select onchange="p.stato=this.value;salva();renderLista()">
        ${["Attivo","Urgente","In-pausa","In-attesa","Archiviato"]
          .map(s=>`<option ${p.stato===s?"selected":""}>${s}</option>`).join("")}
      </select>
    </div>

    <div class="campo">
      <label>Note</label>
      <textarea rows="2" oninput="p.note=this.value;salva()">${p.note}</textarea>
    </div>
  `;
}

function chiudiScheda(){
  document.getElementById("scheda").innerHTML =
    '<p class="placeholder">Seleziona un lavoro per vedere la scheda progetto.</p>';
}

document.addEventListener("keydown",e=>{
  if(e.key==="Escape") chiudiScheda();
});

renderLista();
</script>

</body>
</html>
