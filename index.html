<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestionale Studio â€“ Arch. Aurelio Pezzola</title>

<style>
:root{
  --nero:#111;
  --grigio:#666;
  --bordo:#ddd;
  --fase:#eee;

  --attivo:#3aa655;
  --urgente:#d64545;
  --attesa:#f2c94c;
  --archiviato:#4a6fa5;
}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  margin:0;
  color:var(--nero);
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:24px 32px;
  border-bottom:2px solid var(--nero);
}

nav{display:none;}

main{padding:32px;}

.box{
  border:1px solid var(--bordo);
  padding:24px;
}

#layout{
  display:flex;
  gap:32px;
}

#lista-lavori{
  width:40%;
  list-style:none;
  padding:0;
  margin:0;
}

.lavoro{
  border:1px solid var(--bordo);
  padding:12px;
  margin-bottom:10px;
  background:#fff;
  cursor:pointer;
  display:flex;
  gap:8px;
  align-items:flex-start;
}

.maniglia{
  cursor:grab;
  user-select:none;
}

.info{
  flex:1;
}

.codice{
  font-weight:bold;
}

.badge{
  display:inline-block;
  padding:2px 8px;
  font-size:12px;
  margin-right:6px;
}

.fase{background:var(--fase);}
.attivo{background:var(--attivo);color:#fff;}
.urgente{background:var(--urgente);color:#fff;}
.attesa{background:var(--attesa);}
.archiviato{background:var(--archiviato);color:#fff;}

#scheda{
  width:60%;
  border-left:1px solid var(--bordo);
  padding-left:24px;
}

.campo{margin-bottom:14px;}
.campo label{font-size:12px;color:var(--grigio);}
.campo input,.campo textarea{width:100%;padding:6px;}

.fasi button,.stati button{
  margin:4px 4px 4px 0;
  padding:6px 10px;
  border:1px solid var(--bordo);
  cursor:pointer;
}

.fasi .attiva{background:#ccc;}
.stati .attivo{background:var(--attivo);color:#fff;}
.stati .urgente{background:var(--urgente);color:#fff;}
.stati .attesa{background:var(--attesa);}
.stati .archiviato{background:var(--archiviato);color:#fff;}

@media print{
  header button,#scheda{display:none;}
  #lista-lavori{width:100%;}
}
</style>
</head>

<body>

<header>
  <div>
    <h1>GESTIONALE STUDIO</h1>
    <small>Arch. Aurelio Pezzola</small>
  </div>
  <button onclick="window.print()">ðŸ–¨ Stampa</button>
</header>

<main>
<div class="box">
<h3>Programma Lavori</h3>
<button onclick="aggiungi()">ï¼‹ Aggiungi lavoro</button>

<div id="layout">
<ul id="lista-lavori"></ul>
<div id="scheda"><em>Seleziona un lavoro</em></div>
</div>
</div>
</main>

<script>
const FASI=[
"Progettazione Generale","Modellazione","Relazione Illustrativa",
"Ricerca - Studio","Sopralluogo Cantiere","Riunione - Incontro",
"Direzione Lavori - Coordinamento","Altro"
];
const STATI=["Attivo","Urgente","In attesa","Archiviato"];

let progetti=JSON.parse(localStorage.getItem("progetti"))||[
{codice:"PR-01",titolo:"Nuovo Progetto",fase:FASI[0],stato:"Attivo",note:""}
];

function salva(){
  localStorage.setItem("progetti",JSON.stringify(progetti));
  render();
}

function render(){
  const ul=document.getElementById("lista-lavori");
  ul.innerHTML="";
  progetti.forEach((p,i)=>{
    ul.innerHTML+=`
<li class="lavoro" onclick="apri(${i})" draggable="true"
 ondragstart="drag=i" ondragover="event.preventDefault()"
 ondrop="sposta(${i})">
<span class="maniglia">â˜°</span>
<div class="info">
<div><span class="codice">${p.codice}</span> â€“ ${p.titolo}</div>
<span class="badge fase">${p.fase}</span>
<span class="badge ${classe(p.stato)}">${p.stato}</span>
</div>
</li>`;
  });
}

function classe(s){
 return s=="Attivo"?"attivo":s=="Urgente"?"urgente":s=="In attesa"?"attesa":"archiviato";
}

function apri(i){
 const p=progetti[i];
 document.getElementById("scheda").innerHTML=`
<div class="campo"><label>Codice</label>
<input value="${p.codice}" oninput="p.codice=this.value;salva()"></div>

<div class="campo"><label>Titolo</label>
<input value="${p.titolo}" oninput="p.titolo=this.value;salva()"></div>

<div class="campo"><label>Fase</label>
<div class="fasi">
${FASI.map(f=>`<button class="${p.fase==f?"attiva":""}"
 onclick="p.fase='${f}';salva()">${f}</button>`).join("")}
</div></div>

<div class="campo"><label>Stato</label>
<div class="stati">
${STATI.map(s=>`<button class="${classe(s)}"
 onclick="p.stato='${s}';salva()">${s}</button>`).join("")}
</div></div>

<div class="campo"><label>Note</label>
<textarea rows="2" oninput="p.note=this.value;salva()">${p.note}</textarea></div>

<button onclick="progetti.splice(${i},1);salva()">ðŸ—‘ Elimina</button>
`;
}

let drag=null;
function sposta(i){
 const m=progetti.splice(drag,1)[0];
 progetti.splice(i,0,m);
 salva();
}

function aggiungi(){
 progetti.push({codice:"NUOVO",titolo:"Nuovo lavoro",fase:FASI[0],stato:"Attivo",note:""});
 salva();
}

document.addEventListener("keydown",e=>{
 if(e.key==="Escape")document.getElementById("scheda").innerHTML="<em>Seleziona un lavoro</em>";
});

render();
</script>

</body>
</html>
