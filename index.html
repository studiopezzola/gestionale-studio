<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestionale Studio â€“ Arch. Aurelio Pezzola</title>

<style>
:root{
  --nero:#111;
  --grigio:#666;
  --bordo:#ddd;
  --chiaro:#f5f5f5;

  --attivo:#cfe8ff;
  --attesa:#fff3cd;
  --pausa:#f8d7da;
  --urgente:#f5c6cb;
  --archiviato:#e2e3e5;
}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  margin:0;
  color:var(--nero);
  background:white;
}

header{
  border-bottom:2px solid var(--nero);
  padding:24px 32px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

h1{margin:0;font-size:28px}
h2{margin:4px 0 0;font-size:14px;color:var(--grigio);font-weight:normal}

button{
  padding:8px 12px;
  border:1px solid var(--nero);
  background:white;
  cursor:pointer;
  font-weight:500;
}

main{padding:32px}

.box{
  border:1px solid var(--bordo);
  padding:24px;
}

.box h3{margin-top:0}

.layout{
  display:flex;
  gap:32px;
}

/* LISTA */
#lista-lavori{
  width:35%;
  list-style:none;
  padding:0;
  margin:0;
}

#lista-lavori li{
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px;
  border:1px solid var(--bordo);
  margin-bottom:8px;
  cursor:pointer;
  background:white;
}

.drag{
  cursor:grab;
  font-weight:bold;
}

.stato{
  width:10px;
  height:100%;
  margin-right:6px;
}

.attivo{background:var(--attivo)}
.inattesa{background:var(--attesa)}
.inpausa{background:var(--pausa)}
.urgente{background:var(--urgente)}
.archiviato{background:var(--archiviato)}

/* SCHEDA */
#scheda{
  width:65%;
  border-left:1px solid var(--bordo);
  padding-left:24px;
}

.campo{margin-bottom:16px}
label{font-size:12px;color:var(--grigio)}
input,textarea,select{
  width:100%;
  padding:8px;
  border:1px solid #ccc;
  font-family:inherit;
}

/* STAMPA */
@media print{
  button{display:none}
  header{padding:16px}
  main{padding:16px}
  #lista-lavori{width:100%}
  #scheda{border:none;padding:0}
}
</style>
</head>

<body>

<header>
  <div>
    <h1>GESTIONALE STUDIO</h1>
    <h2>Architetto Aurelio Pezzola</h2>
  </div>
  <div>
    <button onclick="aggiungiLavoro()">ï¼‹ Nuovo lavoro</button>
    <button onclick="window.print()">ðŸ–¨ Stampa</button>
  </div>
</header>

<main>
<div class="box">
<h3>Programma Lavori</h3>

<div class="layout">
  <ul id="lista-lavori"></ul>

  <div id="scheda">
    <p style="color:#666;font-style:italic">
      Seleziona un lavoro per aprire la scheda progetto
    </p>
  </div>
</div>
</div>
</main>

<script>
let progetti = JSON.parse(localStorage.getItem("progetti")) || [
  {codice:"FRAM-01",nome:"Nuovo Museo FRAM",stato:"Attivo",fase:"Progetto definitivo",note:""},
  {codice:"BRE-02",nome:"Via Cambrant",stato:"In attesa",fase:"Studio preliminare",note:""}
];

let attivo = null;

function salva(){
  localStorage.setItem("progetti",JSON.stringify(progetti));
  renderLista();
}

function colore(stato){
  return {
    "Attivo":"attivo",
    "In attesa":"inattesa",
    "In pausa":"inpausa",
    "Urgente":"urgente",
    "Archiviato":"archiviato"
  }[stato] || "";
}

function renderLista(){
  const ul=document.getElementById("lista-lavori");
  ul.innerHTML="";
  progetti.forEach((p,i)=>{
    const li=document.createElement("li");
    li.draggable=true;
    li.innerHTML=`
      <div class="stato ${colore(p.stato)}"></div>
      <span class="drag">â˜°</span>
      <span>${p.nome}</span>
    `;
    li.onclick=()=>apriScheda(i);

    li.ondragstart=e=>e.dataTransfer.setData("i",i);
    li.ondragover=e=>e.preventDefault();
    li.ondrop=e=>{
      const da=e.dataTransfer.getData("i");
      progetti.splice(i,0,progetti.splice(da,1)[0]);
      salva();
    };
    ul.appendChild(li);
  });
}

function apriScheda(i){
  attivo=i;
  const p=progetti[i];
  document.getElementById("scheda").innerHTML=`
    <div style="display:flex;gap:16px">
      <div class="campo" style="width:30%">
        <label>Codice</label>
        <input value="${p.codice}" disabled>
      </div>
      <div class="campo" style="width:70%">
        <label>Nome progetto</label>
        <input value="${p.nome}" oninput="p.nome=this.value;salva()">
      </div>
    </div>

    <div class="campo">
      <label>Fase</label>
      <select onchange="p.fase=this.value;salva()">
        <option ${p.fase=="Studio preliminare"?"selected":""}>Studio preliminare</option>
        <option ${p.fase=="Progetto definitivo"?"selected":""}>Progetto definitivo</option>
        <option ${p.fase=="Progetto esecutivo"?"selected":""}>Progetto esecutivo</option>
        <option ${p.fase=="Cantiere"?"selected":""}>Cantiere</option>
        <option ${p.fase=="Concluso"?"selected":""}>Concluso</option>
      </select>
    </div>

    <div class="campo">
      <label>Stato</label>
      <select onchange="p.stato=this.value;salva()">
        <option>Attivo</option>
        <option>In attesa</option>
        <option>In pausa</option>
        <option>Urgente</option>
        <option>Archiviato</option>
      </select>
    </div>

    <div class="campo">
      <label>Note</label>
      <textarea rows="2" oninput="p.note=this.value;salva()">${p.note}</textarea>
    </div>

    <button onclick="elimina()">ðŸ—‘ Elimina lavoro</button>
  `;
}

function elimina(){
  if(confirm("Eliminare questo lavoro?")){
    progetti.splice(attivo,1);
    attivo=null;
    document.getElementById("scheda").innerHTML="<p>Seleziona un lavoro</p>";
    salva();
  }
}

function aggiungiLavoro(){
  progetti.push({
    codice:"NEW-"+Date.now(),
    nome:"Nuovo lavoro",
    stato:"Attivo",
    fase:"Studio preliminare",
    note:""
  });
  salva();
}

document.addEventListener("keydown",e=>{
  if(e.key==="Escape"){
    document.getElementById("scheda").innerHTML="<p>Seleziona un lavoro</p>";
  }
});

renderLista();
</script>

</body>
</html>
