<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestionale Studio â€“ Arch. Aurelio Pezzola</title>

<style>
:root {
  --nero:#111;
  --grigio:#666;
  --bordo:#ddd;
}

body {
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  margin:0;
  background:white;
  color:var(--nero);
}

header {
  border-bottom:2px solid var(--nero);
  padding:24px 32px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

nav { display:none; }

button {
  padding:8px 12px;
  border:1px solid var(--nero);
  background:white;
  cursor:pointer;
}

main { padding:32px; }

.box {
  border:1px solid var(--bordo);
  padding:24px;
}

h3 { margin-top:0; }

#programma {
  display:flex;
  gap:32px;
}

#lista {
  width:35%;
  list-style:none;
  padding:0;
  margin:0;
}

#lista li {
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px;
  border:1px solid var(--bordo);
  margin-bottom:8px;
  cursor:pointer;
  background:white;
}

.handle {
  cursor:grab;
}

.stato {
  font-size:11px;
  padding:2px 6px;
  border-radius:4px;
  color:white;
}

.stato.Attivo { background:#2ecc71; }
.stato.Urgente { background:#e74c3c; }
.stato.In\ pausa { background:#f39c12; }
.stato.In\ attesa { background:#3498db; }
.stato.Archiviato { background:#7f8c8d; }

#scheda {
  width:65%;
  border-left:1px solid var(--bordo);
  padding-left:24px;
}

.campo {
  margin-bottom:14px;
}

label {
  font-size:12px;
  color:var(--grigio);
}

input, textarea, select {
  width:100%;
  padding:8px;
  border:1px solid #ccc;
  font-family:inherit;
}

#feedback {
  font-size:12px;
  color:green;
  margin-top:8px;
}

@media print {
  button { display:none; }
}
</style>
</head>

<body>

<header>
  <h1>GESTIONALE STUDIO</h1>
  <button onclick="window.print()">ðŸ–¨ Stampa</button>
</header>

<main>
<div class="box">
<h3>Programma Lavori</h3>

<button onclick="aggiungi()">ï¼‹ Aggiungi lavoro</button>

<div id="programma">
<ul id="lista"></ul>
<div id="scheda"><em>Seleziona un lavoro</em></div>
</div>
</div>
</main>

<script>
let lavori = JSON.parse(localStorage.getItem("lavori")) || [
  {codice:"FRAM-01", nome:"Nuovo Museo FRAM", stato:"Attivo", fase:"Progetto definitivo", note:""},
  {codice:"BRE-02", nome:"Via Cambrant", stato:"In attesa", fase:"Studio preliminare", note:""}
];

let attivo = null;

function salva() {
  localStorage.setItem("lavori", JSON.stringify(lavori));
  document.getElementById("feedback")?.remove();
  document.getElementById("scheda")?.insertAdjacentHTML("beforeend","<div id='feedback'>âœ“ salvato</div>");
}

function renderLista() {
  const ul = document.getElementById("lista");
  ul.innerHTML = "";
  lavori.forEach((l,i)=>{
    ul.innerHTML += `
      <li onclick="apri(${i})" draggable="true" ondragstart="drag(${i})" ondrop="drop(${i})" ondragover="event.preventDefault()">
        <span class="handle">â˜°</span>
        ${l.codice} â€“ ${l.nome}
        <span class="stato ${l.stato}">${l.stato}</span>
      </li>`;
  });
}

function apri(i) {
  attivo = i;
  const l = lavori[i];
  document.getElementById("scheda").innerHTML = `
    <div class="campo"><label>Codice</label><input value="${l.codice}" oninput="lavori[${i}].codice=this.value;salva();renderLista()"></div>
    <div class="campo"><label>Nome</label><input value="${l.nome}" oninput="lavori[${i}].nome=this.value;salva();renderLista()"></div>
    <div class="campo"><label>Fase</label><input value="${l.fase}" oninput="lavori[${i}].fase=this.value;salva()"></div>
    <div class="campo"><label>Stato</label>
      <select onchange="lavori[${i}].stato=this.value;salva();renderLista()">
        ${["Attivo","Urgente","In pausa","In attesa","Archiviato"].map(s=>`<option ${l.stato==s?"selected":""}>${s}</option>`).join("")}
      </select>
    </div>
    <div class="campo"><label>Note</label><textarea rows="2" oninput="lavori[${i}].note=this.value;salva()">${l.note}</textarea></div>
    <button onclick="elimina(${i})">ðŸ—‘ Elimina lavoro</button>
  `;
}

function aggiungi() {
  lavori.push({codice:"", nome:"Nuovo lavoro", stato:"Attivo", fase:"", note:""});
  salva();
  renderLista();
}

function elimina(i) {
  if(confirm("Eliminare questo lavoro?")) {
    lavori.splice(i,1);
    salva();
    renderLista();
    document.getElementById("scheda").innerHTML="<em>Seleziona un lavoro</em>";
  }
}

let dragIndex;
function drag(i){ dragIndex=i; }
function drop(i){
  const tmp = lavori[dragIndex];
  lavori.splice(dragIndex,1);
  lavori.splice(i,0,tmp);
  salva();
  renderLista();
}

document.addEventListener("keydown",e=>{
  if(e.key==="Escape") document.getElementById("scheda").innerHTML="<em>Seleziona un lavoro</em>";
});

renderLista();
</script>

</body>
</html>
